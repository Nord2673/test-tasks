<html>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <head>
        <title>Cube</title>
        <style>
            :root{
                --layer-1-color: purple;
                --layer-2-color: blue;
                --layer-3-color: green;
                --layer-4-color: yellow;
                --layer-5-color: orange;
                --layer-6-color: red;
            }
                        
            * {
                box-sizing: border-box;
            }
            body {
                margin: 0;
                font-size: 24px;
                font-weight: 400;
                line-height: 36px;
            }

            .main-container {
                width: 80%;
                margin: auto;
            }
            .main-wrapper {
                box-shadow: 0px 5px 10px 2px #223c5033;
            }

            /* #region input  */
            .layers-amount-label {
                display: inline-block;
                text-align: right;
            }
            .layers-amount-input {
                padding: 5px;
                max-width: 30px;
                font-size: 20px;
            }
            .layers-amount-input:invalid + .validity::after {
                position: absolute;
                content: "✖";
                padding-left: 5px;
            }
            .layers-amount-input:valid + .validity::after {
                position: absolute;
                content: "✓";
                padding-left: 5px;
            }
            .button-container {
                position: relative;
                width: fit-content;
                padding: 0px 10px;
                border-radius: 5px;
                cursor: pointer;
                background-color: #67bcb8;
            }
            .button-text{
                color: #fff;
            }
            /* #endregion input  */
                     
            /* region layers */
            .layer-5{
                --layer-color: red;
                --layer-translateZ: 500px;
                position: absolute;
                z-index: 5;
                transform: translateZ(var(--layer-translateZ));
                /* background-color: var(--layer-6-color); */
                width: 100%;
                height: 100%;
            }
            .layer-4{
                --layer-color: orange;
                --layer-translateZ: 400px;
                position: absolute;
                z-index: 4;
                transform: translateZ(var(--layer-translateZ));
                /* background-color: var(--layer-5-color); */
                width: 100%;
                height: 100%;
            }
            .layer-3{
                --layer-color: yellow;
                --layer-translateZ: 300px;
                position: absolute;
                z-index: 3;
                transform: translateZ(var(--layer-translateZ));
                /* background-color: var(--layer-4-color); */
                width: 100%;
                height: 100%;
            }
            .layer-2{
                --layer-color: green;
                --layer-translateZ: 200px;
                position: absolute;
                z-index: 2;
                transform: translateZ(var(--layer-translateZ));
                /* background-color: var(--layer-3-color); */
                width: 100%;
                height: 100%;
            }
            .layer-1{
                --layer-color: blue;
                --layer-translateZ: 100px;
                display: flex;
                flex-wrap: wrap;
                position: absolute;
                z-index: 1;
                transform: translateZ(var(--layer-translateZ));
                /* background-color: var(--layer-2-color); */
                width: 100%;
                height: 100%;
            }
            .layer-0{
                --layer-color: purple;
                --layer-translateZ: 0px;
                display: flex;
                flex-wrap: wrap;
                position: absolute;
                z-index: 0;
                /* background-color: var(--layer-1-color); */
                width: 100%;
                height: 100%;
            }
            /* endregion layers */

            .parent-cube-container {
                margin-top: 50px;
                margin-left: 100px;
                height: 700px;
            }
            .parent-cube-wrapper {
                /* width: 500px; */
                perspective: 1000px;
                perspective-origin: 150% -50%;
                aspect-ratio: 1/1;
                transform-style: preserve-3d;
            }

            .child-cube-container{
                position: absolute;
                width: 100px;
                height: 100px;
            }
            .child-cube-wrapper {
                position: relative;
                width: 100%;
                height: 100%;
                perspective: calc(1200px - var(--layer-translateZ));
                /* perspective-origin: 250% -50%; */
                transform-style: preserve-3d;
            }

            /* region cube sides */
            .cube-side {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100px;
                height: 100px;
                position: absolute;
                backface-visibility: inherit;
                /* font-size: 60px;
                color: #fff; */
                border: 1px solid black;
            }

            .front {
                background: var(--layer-color);
                transform: translateZ(50px);
            }
            .back {
                background: var(--layer-color);
                transform: rotateY(180deg) translateZ(50px);
            }
            .right {
                background: var(--layer-color);
                filter: brightness(80%);
                transform: rotateY(90deg) translateZ(50px);
            }
            .left {
                background: var(--layer-color);
                filter: brightness(80%);
                transform: rotateY(-90deg) translateZ(50px);
            }
            .top {
                background: var(--layer-color);
                filter: brightness(120%);
                transform: rotateX(90deg) translateZ(50px);
            }
            .bottom {
                background: var(--layer-color);
                filter: brightness(50%);
                transform: rotateX(-90deg) translateZ(50px);
            }
            /* endregion cube sides */
        </style>
    </head>
    <body>
        <div class="main-container">
            <div class="main-wrapper">
                <div class="input-container">
                    <div>
                        <span class="layers-amount-label">Введите кол-во слоев (1-6):</span>
                        <input type="text" class="layers-amount-input" name="layers-amount" required maxlength="1" />
                        <span class="validity"></span>
                    </div>
                    <div class="button-container">
                        <div class="button-wrapper">
                            <div class="button-text" onclick="drawCube()">Подтвердить</div>
                        </div>
                    </div>
                </div>
                <div class="parent-cube-container">
                    <div class="parent-cube-wrapper"></div>
                </div>
            </div>
        </div>
        <script>
            class Cube {
                width = 100;
                height = 100;
                posX;
                posY;
                layer;
                constructor(posX, posY, layer) {
                    this.posX = posX;
                    this.posY = posY;
                    this.layer = layer;
                }
                draw(layersAmount) {
                    const layerElement = document.querySelector(`.layer-${this.layer}`);
                    // const lineElement = layerElement.querySelector(`.layer-${this.posY}`);
                    const container = document.createElement("div");
                    const wrapper = document.createElement("div");
                    const front = document.createElement("div");
                    const back = document.createElement("div");
                    const right = document.createElement("div");
                    const left = document.createElement("div");
                    const top = document.createElement("div");
                    const bottom = document.createElement("div");
                    
                    layerElement.appendChild(container);
                    container.classList.add("child-cube-container");
                    container.style.left = 100 / layersAmount * this.posX + "%";   //заполнение слева-направо снизу-вверх
                    container.style.bottom = 100 / layersAmount * this.posY + "%";
                    // container.style.left = this.posX * this.width + "px";   //заполнение слева-направо снизу-вверх
                    // container.style.bottom = this.posY * this.width + "px";

                    container.appendChild(wrapper);
                    wrapper.classList.add("child-cube-wrapper");
                    let perspectiveX = 50 + (layersAmount - this.posX + 1) * 100;
                    let perspectiveY = -20 - (layersAmount - this.posY + 1) * 100;
                    wrapper.style.perspectiveOrigin = `${perspectiveX}% ${perspectiveY}%`;

                    wrapper.appendChild(front);
                    front.classList.add("cube-side", "front");
                    wrapper.appendChild(back);
                    back.classList.add("cube-side", "back");
                    wrapper.appendChild(right);
                    right.classList.add("cube-side", "right");
                    wrapper.appendChild(left);
                    left.classList.add("cube-side", "left");
                    wrapper.appendChild(top);
                    top.classList.add("cube-side", "top");
                    wrapper.appendChild(bottom);
                    bottom.classList.add("cube-side", "bottom");
                }
            }

            function drawCube() {
                let layersAmount = document.querySelector(".layers-amount-input").value;
                if (layersAmount < 7 && layersAmount > 0) {
                    createLayers(layersAmount);
                    createCubes(layersAmount);
                }
            }

            function createLayers(layersAmount){
                let cubeSideWidth = 100; //перенести
                let parentCube = document.querySelector(".parent-cube-wrapper");
                parentCube.style.width = layersAmount * cubeSideWidth + "px";
                for (let i = layersAmount - 1; i > -1; i--) {
                    const layer = document.createElement("div");
                    parentCube.appendChild(layer).classList.add(`layer-${i}`);
                    // createLines(layer, layersAmount);
                }
            }

            // function createLines(layer, layersAmount){
            //     for (let i = 0; i < layersAmount; i++) {
            //         layer.appendChild(document.createElement("div")).classList.add(`line-${i}`);
            //     }
            // }

            function createCubes(layersAmount){
                let amountOfCubes = Math.pow(layersAmount, 3);
                let amountOfCubesInLayer = layersAmount * layersAmount;
                let counter = 0;
                const cubesInLayers = new Array(layersAmount);
                for (let i = 0; i < layersAmount; i++) {
                    cubesInLayers[i] = [];
                }

                while(counter < amountOfCubes) {
                    let selectedLayer = Math.floor(Math.random() * layersAmount);
                    let curLength = cubesInLayers[selectedLayer].length;
                    if(curLength < amountOfCubesInLayer) {
                        cubesInLayers[selectedLayer][curLength] = new Cube(curLength % layersAmount, Math.floor(curLength / layersAmount), selectedLayer);
                        cubesInLayers[selectedLayer][curLength].draw(layersAmount);
                        counter++;
                    }
                }
            }
        </script>
    </body>
</html>
